#
# QMiner makefile
#
# Prerequisites for documentation:
#  - doxygen:  sudo apt-get install doxygen
#  - GraphViz: sudo apt-get install graphviz
#

include ./Makefile.config

# QMiner version
VERSION = 0.5.0

# dependencies
LIBUV = ../../../libuv
GLIB = ../../../glib
GLIB_BASE = $(GLIB)/base/
GLIB_NET = $(GLIB)/net/
GLIB_MINE = $(GLIB)/mine/
GLIB_MISC = $(GLIB)/misc/
GLIB_THREAD = $(GLIB)/concurrent/

INCLUDE = -I$(GLIB_BASE) -I$(GLIB_NET) -I$(GLIB_MINE) -I$(GLIB_MISC) -I$(GLIB_THREAD) -I$(LIBUV)

STATIC_LIBS = $(GLIB)/glib.a $(LIBUV)/libuv.a

MAINOBJS = SearchPoint.o SearchPointSrv.o

all: searchpoint

lib:
	make -C $(GLIB)
	# compile cpp files
	$(CC) -fPIC -c $(CXXFLAGS) *.cpp $(INCLUDE) $(LDFLAGS) $(LIBS)
	$(CC) -shared -o SearchPointLib.so $(MAINOBJS) $(STATIC_LIBS) $(LDFLAGS) $(LIBS) 
	ar -cvq SearchPointLib.a $(MAINOBJS)
#	$(CC) -o SearchPointLib.a $(MAINOBJS) $(STATIC_LIBS) $(LDFLAGS) $(LIBS) 

searchpoint:
	# compile glib
	make -C $(GLIB)
	# compile cpp files
	$(CC) -c $(CXXFLAGS) *.cpp $(INCLUDE) $(LDFLAGS) $(LIBS)
	# create aminer commandline tool
	$(CC) -o SearchPointSrv $(MAINOBJS) $(STATIC_LIBS) $(LDFLAGS) $(LIBS) 
	# create search point static library
	rm -f SearchPointSrv.a
#	ar -cvq qm.a $(QMOBJS)
	# prepare instalation directory
	mkdir -p build
	# move in qm commandline tool
	mv ./SearchPointSrv ./build/
	# copy in unicode definiton files
	cp $(GLIB)/bin/UnicodeDef.Bin ./build/
	# copy in javascript libraries
	
cleanall: clean
	make -C $(GLIB) clean

clean:
	rm -f *.o *.gch *.a SearchPointSrv
	rm -rf ./build/
