#include <jni.h>
#include <stdio.h>
#include <SearchPoint.h>
#include "SearchPointJava.h"

const PNotify Notify = TStdNotify::New();
TSpSearchPointImpl* sp;

JNIEXPORT void JNICALL Java_SearchPointJava_init(JNIEnv * env, jobject thisObj) {

	Notify->OnNotify(TNotifyType::ntInfo, "Initializing SearchPoint ...");

	Notify->OnNotify(TNotifyType::ntInfo, "Loading UnicodeDef SearchPoint ...");
	TUnicodeDef::Load("./dbs/UnicodeDef.bin");

	TStr DefaultClustUtils = "kmeans";
	THash<TStr, PSpClustUtils> ClustUtilsH;
	ClustUtilsH.AddDat(DefaultClustUtils, TSpDPMeansClustUtils::New());

	Notify->OnNotify(TNotifyType::ntInfo, "Creating SearchPoint instance ...");
	sp = new TSpSearchPointImpl(ClustUtilsH, DefaultClustUtils, 10);
}

/*
 * Class:     SearchPointJava
 * Method:    processQuery
 * Signature: (Ljava/lang/String;Ljava/lang/String;I)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_SearchPointJava_processQuery(JNIEnv * env, jobject thisObj, jstring query, jstring clustKey, jint limit) {
	TStr QueryStr = TStr(env->GetStringUTFChars(query, JNI_FALSE));
	TStr ClustKey = TStr(env->GetStringUTFChars(clustKey, JNI_FALSE));
	TInt Limit = TInt(limit);

	PSpResult Result = sp
}

/*
 * Class:     SearchPointJava
 * Method:    rankByPos
 * Signature: (DDLjava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_SearchPointJava_rankByPos
  (JNIEnv *, jobject, jdouble, jdouble, jstring);

/*
 * Class:     SearchPointJava
 * Method:    fetchKeywords
 * Signature: (DDLjava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_SearchPointJava_fetchKeywords
  (JNIEnv *, jobject, jdouble, jdouble, jstring);

JNIEXPORT void JNICALL JNICALL Java_SearchPointJava_close(JNIEnv * env, jobject thisObjt) {
	Notify->OnNotify(TNotifyType::ntInfo, "Destroying SearchPoint ...");

	Notify->OnNotify(TNotifyType::ntInfo, "Done!");
}
